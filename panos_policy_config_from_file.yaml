---
- hosts: all
  connection: local

  vars:
    device:
      ip_address: "{{ panos_url }}"
      username: "{{ panos_user }}"
      password: "{{ panos_password }}"
  vars_files:
    - "{{ load_file_name }}"
  tasks:

    - paloaltonetworks.panos.panos_security_rule:
        provider: "{{ device }}"
        rule_name: "{{ item.rule_name }}"
        description: "{{ item.description | default('') }}"
        source_zone: "{{ item.source_zone }}"
        source_ip: "{{ item.source_ip }}"
        destination_zone: "{{ item.destination_zone }}"
        destination_ip: "{{ item.destination_ip }}"
        application: "{{ item.application }}"
        action: "{{ item.rule_action }}"
      loop: "{{ policies }}"

    - paloaltonetworks.panos.panos_commit_firewall:
        provider: '{{ device }}'
